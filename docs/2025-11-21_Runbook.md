---
title: "Gatherly Runbook ‚Äî 2025-11-21"
owner: "Engineering & Ops"
lastReviewed: "2025-11-21"
---

# 1. Purpose

Provide a single, authoritative guide for running, testing, and demonstrating the current Gatherly stack (Spring Boot + PostgreSQL + React Native/Expo). Use this during private alpha bring-up, QA sessions, or new engineer onboarding.

# 2. Prerequisites

| Component | Version | Notes |
|-----------|---------|-------|
| Java JDK | 17+ | Verify with `java -version`. |
| Maven | 3.9+ | Used for backend build/test. |
| Node.js | 18+ | Align with `frontend/package.json`. |
| Yarn or npm | Latest LTS | Expo CLI works with either; repo currently uses `npm`. |
| Expo CLI | `npm install -g expo-cli` | Required for device builds / `expo start`. |
| PostgreSQL | v15+ | Local dev DB (or use Docker via `docker-compose`). |
| ngrok (optional) | latest | For exposing local backend to devices if needed. |

Environment variables (sample `.env` already available):

```bash
# backend/.env (or export before running `mvn spring-boot:run`)
DB_HOST=localhost
DB_PORT=5432
DB_NAME=gathr
DB_USERNAME=postgres
DB_PASSWORD=postgres
JWT_SECRET=change-me
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/xxx
SMS_PROVIDER=twilio
TWILIO_ACCOUNT_SID=...
TWILIO_AUTH_TOKEN=...
TWILIO_PHONE_NUMBER=+1...

# frontend/.env
EXPO_PUBLIC_API_URL=http://localhost:8080
EXPO_PUBLIC_WS_URL=ws://localhost:8080
EXPO_PUBLIC_MOCK_MODE=false   # set true for offline demo mode
```

# 3. Backend: Setup & Run

1. **Start PostgreSQL**
   ```bash
   docker-compose up postgres
   # or
   docker run -d --name gathr-postgres \
     -e POSTGRES_DB=gathr \
     -e POSTGRES_USER=postgres \
     -e POSTGRES_PASSWORD=postgres \
     -p 5432:5432 postgres:15
   ```
2. **Apply Flyway migrations** (auto-run on boot). To force:
   ```bash
   cd backend_root
   mvn flyway:migrate
   ```
3. **Seed data**: `DataSeeder` inserts hubs & sample activities automatically on first run.
4. **Run backend**
   ```bash
   mvn clean spring-boot:run
   # or package + run
   mvn clean package
   java -jar target/gathr-backend-1.0.0.jar
   ```
5. **Verify**  
   - `curl http://localhost:8080/actuator/health` ‚Üí should return `{"status":"UP"}`.  
   - `curl http://localhost:8080/hubs -H "Authorization: Bearer <token>"`.

# 4. Frontend: Setup & Run

1. **Install deps**
   ```bash
   cd frontend
   npm install
   ```
2. **Configure `.env`** using `frontend/.env.example` (set API URLs & mock flag).
3. **Start Expo**
   ```bash
   npm start
   # or
   expo start
   ```
4. **Mock mode vs real mode**
   - `EXPO_PUBLIC_MOCK_MODE=true`: uses local JSON data (`src/mock/data.json`) for offline demos.
   - `EXPO_PUBLIC_MOCK_MODE=false`: hits real backend defined by `EXPO_PUBLIC_API_URL`.
5. **Run on devices**
   - Press `i` for iOS simulator, `a` for Android, or scan QR with Expo Go.  
   - For physical devices, ensure backend is accessible via LAN or ngrok (update API URL accordingly).

# 5. Test / Demo flows (recommended order)

1. **Authentication**
   - Open app ‚Üí enter phone ‚Üí trigger OTP (handle rate limit).  
   - Enter OTP (`123456` in mock) ‚Üí verify auto-login persists across restarts.
2. **Activity feed**
   - Switch hubs, inspect invite-only lock icon, max-member state (full vs available).  
   - Validate mutuals badge (requires contact upload & backend mutual data).
3. **Join / Invite**
   - Join public activity.  
   - For invite-only: generate token via detail screen, redeem via modal, test SMS flow (mock).  
   - Verify backend rejects invalid / expired tokens (403).
4. **Create activity**
   - Use template (once wired) or manual form; confirm new activity appears in feed and detail view.
5. **Chat**
   - Open chat on two devices; ensure WebSocket connection indicator toggles (üü¢/üü°).  
   - Send messages, mark ‚ÄúHeading There,‚Äù watch reveal logic flip once thresholds met.  
   - Confirm message expiry countdown and Slack report workflow (submit report ‚Üí check Slack channel).
6. **Contacts & mutuals**
   - Upload hashed contacts, verify backend response, ensure mutual count surfaces on cards/participants.  
   - Toggle contact sharing off in Settings.
7. **Feedback (once shipped)**
   - After activity end time, trigger post-meet modal, submit `did_meet` + `would_meet_again`.

# 6. Troubleshooting

| Symptom | Likely Cause | Fix |
|---------|--------------|-----|
| `401 Unauthorized` on API calls | Missing/expired JWT | Re-login via OTP; ensure frontend `SecureStore` saved token. |
| OTP start returns `429` | Rate limit hit | Wait 1 hour or use different test phone; check `AuthService` logs. |
| WebSocket not connecting | Wrong `EXPO_PUBLIC_WS_URL` or backend not exposed | Use `ws://<LAN_IP>:8080`, confirm network access, fallback polling should keep chat functional. |
| Slack report missing | `SLACK_WEBHOOK_URL` unset or network blocked | Verify env var; check backend logs for WebClient errors. |
| Contact upload returns 500 | Contacts permission denied or payload empty | Ensure device granted access; check `ContactsUploadScreen` logs. |
| Expo app can‚Äôt reach backend | Device on different network | Use ngrok and set `EXPO_PUBLIC_API_URL` to ngrok HTTPS URL. |

# 7. Observability & Ops Notes

- **Logs:** Spring Boot logs to stdout (view via terminal or use `LOG_LEVEL` env).  
- **Metrics:** Use `/actuator/metrics` if Micrometer enabled; otherwise rely on logs + DB queries.  
- **Backups:** See `DATABASE_BACKUP_STRATEGY.md` for pg_dump/WAL instructions.  
- **Alerts:** Slack incoming webhook (reports) + optional SMS alerts for critical failures (TODO).

# 8. Appendix: Useful Commands

```bash
# Run backend tests
mvn test

# Lint / test frontend
cd frontend
npm test

# Clean Expo cache if weird errors
expo start -c

# Drop & recreate DB (dev only)
psql -U postgres -c "DROP DATABASE gathr;"
psql -U postgres -c "CREATE DATABASE gathr;"
```

---

Keep this runbook versioned; update whenever deployment steps, env vars, or QA flows change.

